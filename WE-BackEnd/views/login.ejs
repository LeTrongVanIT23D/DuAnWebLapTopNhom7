<!DOCTYPE html>
<html lang="en">

<%- include('./partials/head.ejs') %>


    <body class="bg-gray-100" data-alert=`${alert ? alert : '' }`>
        <div class="container mt-5">
            <div class="row justify-content-center">
                <div class="col-xl-9 col-lg-11 col-md-10">

                    <div class="card o-hidden border-0 shadow-xl my-5 rounded-xl">
                        <div class="card-body p-0">
                            <div class="row">
                                <div class="col-lg-6 d-none d-lg-block rounded-l-xl"
                                    style="background-image: url(https://images.unsplash.com/photo-1550745165-9bc0b252726f?q=80&w=1920&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D);
                                    background-position: center; background-size: cover; border-top-left-radius: 0.75rem; border-bottom-left-radius: 0.75rem;">
                                    <div class="p-5 text-center text-white bg-black bg-opacity-40 h-full flex flex-col justify-center items-center">
                                        <h2 class="text-3xl font-bold mb-3">ADMIN PORTAL</h2>
                                        <p class="text-lg">Quản lý kho hàng, đơn đặt hàng và hệ thống website.</p>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="p-6 md:p-8">
                                        <div class="text-center mb-5">
                                            <h1 class="h3 text-gray-900 font-bold mb-2">Chào mừng trở lại!</h1>
                                            <p class="text-sm text-gray-500">Đăng nhập để tiếp tục quản lý.</p>
                                        </div>
                                        
                                        <form class="user">
                                            <div class="form-group mb-4">
                                                <input type="email" class="form-control form-control-user" id="email"
                                                    aria-describedby="emailHelp" placeholder="Địa chỉ Email...">
                                                <input type="hidden" id="checkLogin">
                                            </div>
                                            <div class="form-group mb-4">
                                                <input type="password" class="form-control form-control-user"
                                                    id="password" placeholder="Mật khẩu">
                                            </div>
                                            
                                            <div class="form-group flex justify-between items-center mb-6">
                                                <div class="custom-control custom-checkbox small">
                                                    <input type="checkbox" class="custom-control-input" id="customCheck">
                                                    <label class="custom-control-label text-sm text-gray-600" for="customCheck">Ghi nhớ tôi</label>
                                                </div>
                                                <a class="small text-blue-600 hover:text-blue-800" href="/forgot-password">Quên mật khẩu?</a>
                                            </div>

                                            <button class="btn btn-primary btn-user btn-block text-white font-semibold uppercase tracking-wider py-3 rounded-full hover:bg-blue-700 transition-colors" id="login">
                                                Đăng nhập
                                            </button>
                                            
                                            <hr class="my-6">
                                            
                                            <div class="form-group text-center mb-3">
                                                <button class="btn btn-block btn-social btn-google bg-red-500 hover:bg-red-600 text-white font-semibold py-2 rounded-lg transition-colors" id="btnGoogle" type="button"> 
                                                    <i class="fab fa-google fa-fw mr-2"></i> Đăng nhập với Google
                                                </button>
                                            </div>
                                            <div class="form-group text-center">
                                                <button class="btn btn-block btn-social btn-facebook bg-blue-700 hover:bg-blue-800 text-white font-semibold py-2 rounded-lg transition-colors" id="btnFacebook" type="button"> 
                                                    <i class="fab fa-facebook-f fa-fw mr-2"></i> Đăng nhập với Facebook
                                                </button>
                                            </div>
                                        </form>
                                        
                                        <hr class="my-6">
                                        
                                        <div class="text-center">
                                            <a class="small text-gray-600" href="/register">Chưa có tài khoản? Đăng ký ngay!</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

        </div>

        <script src="/js/alerts.js"></script>
        <script type="module">
            // Import the functions you need from the SDKs you need
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";
            import { getAuth, FacebookAuthProvider, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-auth.js";
            
            // Your web app's Firebase configuration
            const firebaseConfig = {
                apiKey: "AIzaSyAb86cfstfZo11kk5EwkI3KPfPcXTV3DdI",
                authDomain: "hc-tech.firebaseapp.com",
                projectId: "hc-tech",
                storageBucket: "hc-tech.appspot.com",
                messagingSenderId: "707901541960",
                appId: "1:707901541960:web:23da34b0b69a7af384927d",
                measurementId: "G-74XYX837EE"
            };
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const provider = new GoogleAuthProvider(app);
            const facebookProvider = new FacebookAuthProvider(app);
            const btnGoogle = document.getElementById('btnGoogle');
            const btnFacebook = document.getElementById('btnFacebook'); // Lấy nút Facebook

            // Google Login
            btnGoogle.addEventListener('click', async e => {
                try {
                    const result = await signInWithPopup(auth, provider);
                    const user = result.user;
                    // Sau khi đăng nhập Firebase thành công, chuyển email sang hidden input
                    $("#checkLogin").val(user.email);
                    // Kích hoạt sự kiện change để login.js xử lý
                    $("#checkLogin").trigger('change'); 
                } catch (error) {
                    let errorMessage = error.message;
                    if (error.message.includes("auth/popup-closed-by-user")) {
                         errorMessage = "Đã hủy đăng nhập";
                    }
                    showAlert("error", errorMessage);
                }
            });

            // Facebook Login (Thêm logic Facebook)
            btnFacebook.addEventListener('click', async e => {
                try {
                    const result = await signInWithPopup(auth, facebookProvider);
                    const user = result.user;
                    $("#checkLogin").val(user.email);
                    $("#checkLogin").trigger('change');
                } catch (error) {
                    let errorMessage = error.message;
                    if (error.message.includes("auth/popup-closed-by-user")) {
                        errorMessage = "Đã hủy đăng nhập";
                    } else if (error.message.includes("auth/account-exists-with-different-credential")) {
                        errorMessage = "Tài khoản đã tồn tại với hình thức đăng nhập khác.";
                    }
                    showAlert("error", errorMessage);
                }
            });

        </script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH57pYc0x4Q/zD9yF0bV1z8W8s3aK1N6V8V3i0V2u7p8J/l/d0r+b0iP7oK9e/B7D/Ww+G2b1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        
        <script src="/js/login.js"></script>
    </body>

</html>